<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ ticker }} Chart</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h1 class="mb-4">{{ ticker }} Chart</h1>
    <a href="{{ url_for('dashboard') }}" class="btn btn-secondary mb-3">Back to Dashboard</a>
    <div id="chart" style="height: 400px;"></div>
</div>
<script src="{{ url_for('static', filename='lightweight-charts.standalone.production.js') }}"></script>
<script>
    // Prepare data from Flask context
    var ohlc = {{ ohlc|tojson|safe }};
    var vwma = {{ vwma|tojson|safe }};

    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
        width: 800,
        height: 400,
        layout: { background: { color: '#f8f9fa' }, textColor: '#222' },
        grid: { vertLines: { color: '#eee' }, horzLines: { color: '#eee' } }
    });

    const candleSeries = chart.addCandlestickSeries();
    candleSeries.setData(ohlc.map(row => ({
        time: row.time,
        open: row.open,
        high: row.high,
        low: row.low,
        close: row.close
    })));

    if (vwma.length > 0) {
        const vwmaSeries = chart.addLineSeries({ color: 'blue', lineWidth: 2 });
        vwmaSeries.setData(vwma);
    }
</script>
</body>
</html>
